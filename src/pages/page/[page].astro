---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Container from '../../components/Container.astro';
import PostGrid from '../../components/PostGrid.astro';
import Pagination from '../../components/Pagination.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';

export async function getStaticPaths({ paginate }: { paginate: any }) {
	const allPosts = (await getCollection('blog')).sort(
		(a, b) => (b.data.pubDate?.valueOf() || 0) - (a.data.pubDate?.valueOf() || 0),
	);
	
	// Generate paginated pages with 9 posts per page
	return paginate(allPosts, { pageSize: 9 });
}

interface Page {
	data: any[];
	currentPage: number;
	lastPage: number;
	url: {
		current: string;
		prev?: string;
		next?: string;
		first?: string;
		last?: string;
	};
}

const { page }: { page: Page } = Astro.props;
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
	<Container>
		<section>
			<PostGrid posts={page.data} />
			<Pagination 
				currentPage={page.currentPage} 
				totalPages={page.lastPage}
				getPageUrl={(pageNum) => pageNum === 1 ? '/' : `/page/${pageNum}`}
			/>
		</section>
	</Container>
</BaseLayout>

